<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>4.4. Field-Oriented Control (FOC) &#8212; MCAF R7 RC37 documentation (docver 7.0.2)</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/microchip.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mcaf_doc.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/contrib/auto-render.min.js"></script>
    <script src="../_static/rendermath.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js"></script>
    <script src="../_static/svgcrop.js"></script>
    <script src="../_static/mcaf-styling.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.5. Test Harness" href="testharness.html" />
    <link rel="prev" title="4.3. State Machine" href="statemach.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="testharness.html" title="4.5. Test Harness"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="statemach.html" title="4.3. State Machine"
             accesskey="P">previous</a> |</li>
    <li><img class="nav-logo"
             src="../_static/Microchip-Logo-Horizontal-White-Red-120x28.png" alt=""
        /></li>
    <li><a href=""></a> &#187;</li>
    <a href="../index.html">MCAF R7 RC37 (docver 7.0.2)</a> &#187;
    
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">4. </span>Components</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.4. </span>Field-Oriented Control (FOC)</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="field-oriented-control-foc">
<span id="foc"></span><span id="index-0"></span><h1><span class="section-number">4.4. </span>Field-Oriented Control (FOC)<a class="headerlink" href="#field-oriented-control-foc" title="Permalink to this heading">¶</a></h1>
<p></p>
<p><a class="reference internal" href="../appendix/glossary.html#term-FOC"><span class="xref std std-term">FOC</span></a> consists of a velocity controller, a current controller, and
commutation and estimation subcomponents.
A high-level block diagram of the <a class="reference internal" href="../appendix/glossary.html#term-FOC"><span class="xref std std-term">FOC</span></a> components is shown in <a class="reference internal" href="#fig-foc-blkdiag"><span class="std std-numref">Figure 4.2</span></a>.</p>
<figure class="align-center" id="id6">
<span id="fig-foc-blkdiag"></span><a class="reference external image-reference" href="../dataflow-diagram/dataflow-diagrams.html"><img alt="../_images/accret-bdiag.svg" src="../_images/accret-bdiag.svg" /></a>
<figcaption>
<p><span class="caption-number">Figure 4.2 </span><span class="caption-text">Block diagram of MCAF Field Oriented Control</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>This diagram shows a number of features that are described
in the <a class="reference internal" href="testharness.html#test-harness"><span class="std std-ref">test harness</span></a>.</p>
<section id="velocity-control">
<span id="index-1"></span><span id="id1"></span><h2><span class="section-number">4.4.1. </span>Velocity Control<a class="headerlink" href="#velocity-control" title="Permalink to this heading">¶</a></h2>
<p>The velocity control loop is a straightforward, scalar PI controller, with
managed saturation features to prevent integrator windup when either the
velocity or current controller saturates.</p>
<p>It is preceded by a rate limiter, to provide more gentle trajectory
shaping and reduce transient overshoot.</p>
<p>Saturation and antiwindup features are present and covered in a
<a class="reference internal" href="../appendix/otherdocs.html#otherdocs-saturation"><span class="std std-ref">separate document</span></a>.</p>
<section id="voltage-control">
<span id="index-2"></span><span id="id2"></span><h3><span class="section-number">4.4.1.1. </span>Voltage Control<a class="headerlink" href="#voltage-control" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="../algorithms/voltage-control.html#algorithm-voltagecontrol"><span class="std std-ref">Voltage control</span></a> is an alternative control structure available
in MCAF R7. In voltage control, back-emf is used as a proxy for velocity control, with some
compliance due to the stator resistance. When this feature is active, the current control loop
and the active position/velocity estimators are operating normally.</p>
</section>
</section>
<section id="current-control">
<span id="id3"></span><h2><span class="section-number">4.4.2. </span>Current Control<a class="headerlink" href="#current-control" title="Permalink to this heading">¶</a></h2>
<p>The current control loop is a vector control loop that operates in the
<em>dq</em> reference frame, with reference transforms to convert to/from the <em>ABC</em>
stationary reference frame in which currents are measured and duty cycles
are commanded. The vector control loop itself is a straightforward pair of PI controllers,
with managed saturation features to prevent integrator windup when the
current controller saturates. (Saturation and antiwindup features are covered in
more detail in a <a class="reference internal" href="../appendix/otherdocs.html#otherdocs-saturation"><span class="std std-ref">separate document</span></a>.)</p>
<p><a class="reference internal" href="#fig-foc-blkdiag"><span class="std std-numref">Figure 4.2</span></a> shows a filter block preceding the current controller.
It is intended to slow down incoming commands from the velocity loop, which
typically executes at a slower rate.</p>
<p><a class="reference internal" href="#fig-foc-blkdiag"><span class="std std-numref">Figure 4.2</span></a> also shows DC link voltage compensation following the
Inverse Park Transform.</p>
</section>
<section id="position-and-velocity-estimator">
<span id="posvelest"></span><h2><span class="section-number">4.4.3. </span>Position and Velocity Estimator<a class="headerlink" href="#position-and-velocity-estimator" title="Permalink to this heading">¶</a></h2>
<p>MCAF provides several <a class="reference internal" href="../algorithms/estimators.html#algorithm-estimators"><span class="std std-ref">position and velocity estimators</span></a>
used for commutation and velocity control:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../algorithms/pll.html#algorithm-pll"><span class="std std-ref">AN1292 Phase-locked loop (PLL)</span></a></p></li>
<li><p><a class="reference internal" href="../algorithms/atpll.html#algorithm-atpll"><span class="std std-ref">Angle-tracking phase-locked loop (ATPLL)</span></a></p></li>
<li><p><a class="reference internal" href="../algorithms/qei.html#algorithm-qei"><span class="std std-ref">Quadrature encoder (QEI)</span></a></p></li>
<li><p><a class="reference internal" href="../algorithms/zsmt.html#algorithm-zsmt"><span class="std std-ref">Zero-Speed / Maximum Torque (ZS/MT)</span></a></p></li>
</ul>
</section>
<section id="implementation-notes">
<h2><span class="section-number">4.4.4. </span>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permalink to this heading">¶</a></h2>
<section id="foc-feature-support">
<h3><span class="section-number">4.4.4.1. </span>FOC feature support<a class="headerlink" href="#foc-feature-support" title="Permalink to this heading">¶</a></h3>
<section id="flux-weakening">
<h4><span class="section-number">4.4.4.1.1. </span>Flux weakening<a class="headerlink" href="#flux-weakening" title="Permalink to this heading">¶</a></h4>
<p>In MCAF R1 – R5, flux weakening was not provided,
and the velocity controller set the d-axis current command to zero.</p>
<p>Since MCAF R6, flux weakening has been provided as part of the <a class="reference internal" href="../algorithms/flux_control/index.html#algorithm-flux-control"><span class="std std-ref">Flux control</span></a> module.</p>
</section>
<section id="current-command-prefilter">
<h4><span class="section-number">4.4.4.1.2. </span>Current command prefilter<a class="headerlink" href="#current-command-prefilter" title="Permalink to this heading">¶</a></h4>
<p>The filter just prior to the current controller is unimplemented in MCAF
R1 – R7, but is reserved for a future version.</p>
</section>
<section id="dc-link-voltage-compensation">
<h4><span class="section-number">4.4.4.1.3. </span>DC link voltage compensation<a class="headerlink" href="#dc-link-voltage-compensation" title="Permalink to this heading">¶</a></h4>
<p><a class="reference internal" href="../algorithms/foc/dclink-comp.html#algorithm-dclinkcompensation"><span class="std std-ref">DC link voltage compensation</span></a> was not implemented for MCAF R1, but has been
implemented since MCAF R2. In MCAF R1, the multiply between <span class="math notranslate nohighlight">\(V_{dq}\)</span> and <span class="math notranslate nohighlight">\(D_{dq}\)</span> is not present.</p>
</section>
<section id="pwm-duty-cycle-realization">
<span id="foc-zsm"></span><h4><span class="section-number">4.4.4.1.4. </span>PWM duty cycle realization<a class="headerlink" href="#pwm-duty-cycle-realization" title="Permalink to this heading">¶</a></h4>
<p>MCAF R1 used an implementation of conventional space-vector PWM (CSVPWM)
from the Microchip Motor Control Library (<code class="docutils literal notranslate"><span class="pre">MC_CalculateSpaceVectorPhaseShifted_Assembly</span></code>).
Starting with MCAF R2, this has been switched to use a Zero Sequence Modulation block,
which includes clipping within realizable limits (minimum and maximum duty cycle limits)
in order to support <a class="reference internal" href="../algorithms/foc/overmodulation.html#algorithm-overmodulation"><span class="std std-ref">overmodulation</span></a>. See <code class="docutils literal notranslate"><span class="pre">MCAF_FocStepIsrForwardPath()</span></code>.</p>
<p>For more information on ZSM, see Microchip’s <a class="reference external" href="http://microchipdeveloper.com/mct5001:start">Zero Sequence Modulation Tutorial</a>.</p>
</section>
<section id="velocity-loop-current-limit">
<span id="foc-impl-iqlimit"></span><h4><span class="section-number">4.4.4.1.5. </span>Velocity loop current limit<a class="headerlink" href="#velocity-loop-current-limit" title="Permalink to this heading">¶</a></h4>
<p>The velocity loop controller has upper and lower limits for its output, a q-axis current reference.</p>
<p>MCAF R1 – R5 used fixed upper and lower limits, equal to <span class="math notranslate nohighlight">\(\plusmn I_{\max}\)</span>,
the rated continuous drive current or rated continuous motor current, whichever is loewr.</p>
<p>Since MCAF R6, the velocity controller uses a limit computed by the
<a class="reference internal" href="../algorithms/flux_control/index.html#algorithm-flux-control"><span class="std std-ref">flux control module</span></a>,
that is bounded by <span class="math notranslate nohighlight">\(\plusmn I_{\max}\)</span>. Depending on the type of current limit
region used, this limit may be fixed or may be changing dynamically.
For more details, see <a class="reference internal" href="../algorithms/flux_control/flux_weakening_mtpa_integration.html#algorithm-fluxctrl-iqlim"><span class="std std-ref">Calculation of q-axis current limit</span></a>.</p>
</section>
<section id="saturation-and-anti-windup">
<span id="foc-impl-sat-antiwindup"></span><h4><span class="section-number">4.4.4.1.6. </span>Saturation and anti-windup<a class="headerlink" href="#saturation-and-anti-windup" title="Permalink to this heading">¶</a></h4>
<p>Velocity loop error integration is inhibited when certain velocity anti-windup conditions occur.</p>
<p>In MCAF R1 – R5, velocity anti-windup conditions include detection of current and voltage saturation.</p>
<p>Since MCAF R6, voltage saturation is not used for velocity anti-windup,
when <a class="reference internal" href="../algorithms/flux_control/flux_weakening.html#algorithm-flux-weakening"><span class="std std-ref">flux weakening</span></a> is enabled,
to allow entry into the flux-weakening region.
When flux weakening is disabled, voltage saturation is used for velocity anti-windup.</p>
</section>
<section id="flux-control">
<h4><span class="section-number">4.4.4.1.7. </span>Flux control<a class="headerlink" href="#flux-control" title="Permalink to this heading">¶</a></h4>
<p><a class="reference internal" href="../algorithms/flux_control/index.html#algorithm-flux-control"><span class="std std-ref">Flux control</span></a>, including <a class="reference internal" href="../algorithms/flux_control/flux_weakening.html#algorithm-flux-weakening"><span class="std std-ref">flux weakening</span></a>
and <a class="reference internal" href="../algorithms/flux_control/mtpa.html#algorithm-mtpa"><span class="std std-ref">MTPA</span></a>, was added as an option in MCAF R6.</p>
</section>
<section id="current-measurement-gain-and-offset-compensation">
<h4><span class="section-number">4.4.4.1.8. </span>Current measurement / gain and offset compensation<a class="headerlink" href="#current-measurement-gain-and-offset-compensation" title="Permalink to this heading">¶</a></h4>
<p><a class="reference internal" href="../algorithms/foc/current_measure.html#algorithm-gainofs"><span class="std std-ref">Gain and offset compensation</span></a>
are included in MCAF to handle several aspects
of <a class="reference internal" href="../algorithms/foc/current_measure.html#algorithm-current-measure"><span class="std std-ref">current measurement</span></a>:</p>
<ul class="simple">
<li><p>run-time compensation of current offset error</p></li>
<li><p>compile-time compensation of current gain error,
for cases such as the <a class="reference internal" href="../appendix/mclv2.html#appendix-mclv2"><span class="std std-ref">MCLV-2</span></a></p></li>
<li><p>use of single/dual/triple-channel measurement</p></li>
</ul>
</section>
<section id="dead-time-compensation">
<h4><span class="section-number">4.4.4.1.9. </span>Dead-time compensation<a class="headerlink" href="#dead-time-compensation" title="Permalink to this heading">¶</a></h4>
<p><a class="reference internal" href="../algorithms/dead-time-comp.html#algorithm-deadtimecompensation"><span class="std std-ref">Dead-time compensation</span></a> was added as an option in MCAF R6.</p>
</section>
</section>
<section id="numerical-values-for-pwm-duty-cycle-and-dead-time">
<span id="foc-pwm-duty"></span><h3><span class="section-number">4.4.4.2. </span>Numerical values for PWM duty cycle and dead time<a class="headerlink" href="#numerical-values-for-pwm-duty-cycle-and-dead-time" title="Permalink to this heading">¶</a></h3>
<p>It is important to understand some of the subtleties of PWM duty cycle in MCAF, in the presence of dead time.
Interpretation of particular numeric duty cycles
(for example, d = 0.1) can be slightly tricky. This section documents how they are used,
and how to determine the correct values given known limits of the power electronics.
<a class="reference internal" href="#fig-foc-pwmdeadtime"><span class="std std-numref">Figure 4.3</span></a> shows several important points related to PWM duty cycle and dead time.</p>
<figure class="align-center" id="id7">
<span id="fig-foc-pwmdeadtime"></span><img alt="../_images/pwm-with-deadtime.svg" src="../_images/pwm-with-deadtime.svg" /><figcaption>
<p><span class="caption-number">Figure 4.3 </span><span class="caption-text">Interpreting duty cycle correctly</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>A typical PWM peripheral for use with a half-bridge circuit produces three waveforms:</p>
<ul class="simple">
<li><p>a raw generated pulse waveform G with duty cycle <span class="math notranslate nohighlight">\(D\)</span></p></li>
<li><p>high-side output H with the leading edge delayed by dead time <span class="math notranslate nohighlight">\(\delta_1\)</span>,</p></li>
<li><p>low-side output L inverted and with the trailing edge delayed by dead time <span class="math notranslate nohighlight">\(\delta_1\)</span>.</p></li>
</ul>
<p>Other implementations may split dead time in half symmetrically. (see <a class="reference internal" href="#foc-pwm-33"><span class="std std-ref">note on dsPIC33 PWM</span></a>)</p>
<ul class="simple">
<li><p>The intended duty cycle of the entire half-bridge is <span class="math notranslate nohighlight">\(D\)</span>.</p></li>
<li><p>The duty cycle of the high-side gate drive is <span class="math notranslate nohighlight">\(D-\delta_1\)</span>. (with <span class="math notranslate nohighlight">\(\delta_1\)</span> expressed as a fraction of total PWM period)</p></li>
<li><p>The duty cycle of the low-side gate drive is <span class="math notranslate nohighlight">\(1-D-\delta_1\)</span>.</p></li>
<li><p>With inductive loads, and transistor on-time and off-time roughly equal, the effective duty cycle of the entire half bridge is</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(D-\delta_1\)</span> if current is flowing out of the half bridge (the low-side diode conducts during dead time),</p></li>
<li><p><span class="math notranslate nohighlight">\(D+\delta_1\)</span> if current is flowing into the half bridge (the high-side diode conducts during dead time),</p></li>
<li><p>or somewhere in between if current does not stay positive or negative during the entire dead time — this represents discontinuous conduction.</p></li>
</ul>
</li>
</ul>
<p>Circuit designers of the half bridge should record the following quantities:</p>
<ul class="simple">
<li><p>Minimum duty cycle <span class="math notranslate nohighlight">\(D_{HMIN}\)</span> and maximum duty cycle <span class="math notranslate nohighlight">\(D_{HMAX}\)</span> of the high-side transistor</p></li>
<li><p>Minimum duty cycle <span class="math notranslate nohighlight">\(D_{LMIN}\)</span> and maximum duty cycle <span class="math notranslate nohighlight">\(D_{LMAX}\)</span> of the low-side transistor</p></li>
<li><p>Desired dead time <span class="math notranslate nohighlight">\(\delta_1\)</span></p></li>
</ul>
<p>The relevant parameters that should be entered into motorBench<sup>®</sup> Development Suite are:</p>
<ul class="simple">
<li><p>Minimum duty cycle of the bridge <span class="math notranslate nohighlight">\(D_{BMIN}=\max(D_{HMIN},1-D_{LMAX}-2\delta_1)\)</span></p></li>
<li><p>Maximum duty cycle of the bridge <span class="math notranslate nohighlight">\(D_{BMAX}=\min(1-D_{HMIN},D_{HMAX}+2\delta_1)\)</span></p></li>
</ul>
<p>This will produce the range of duty cycles shown in <a class="reference internal" href="#table-foc-dutycycleeqns"><span class="std std-numref">Table 4.1</span></a>.</p>
<table class="docutils align-default" id="table-foc-dutycycleeqns">
<caption><span class="caption-number">Table 4.1 </span><span class="caption-text">Duty cycle ranges for PWM waveforms</span><a class="headerlink" href="#table-foc-dutycycleeqns" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Waveform</p></th>
<th class="head"><p>Minimum duty cycle</p></th>
<th class="head"><p>Maximum duty cycle</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>G</p></td>
<td><p><span class="math notranslate nohighlight">\(D_{BMIN} + \delta_1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(D_{BMAX} - \delta_1\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>H</p></td>
<td><p><span class="math notranslate nohighlight">\(D_{BMIN}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(D_{BMAX} - 2\delta_1\)</span></p></td>
</tr>
<tr class="row-even"><td><p>L</p></td>
<td><p><span class="math notranslate nohighlight">\(1-D_{BMAX}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1-D_{BMIN} - 2\delta_1\)</span></p></td>
</tr>
</tbody>
</table>
<p>Usually the two minimum duty cycles <span class="math notranslate nohighlight">\(D_{LMIN}\)</span> and <span class="math notranslate nohighlight">\(D_{HMIN}\)</span> determine the duty cycle limits, not the maximum duty cycles.</p>
<p>To help clarify how this works, some concrete examples are given below.</p>
<section id="pwm-peripheral-in-dspic33-devices">
<span id="foc-pwm-33"></span><h4><span class="section-number">4.4.4.2.1. </span>PWM peripheral in dsPIC33 devices<a class="headerlink" href="#pwm-peripheral-in-dspic33-devices" title="Permalink to this heading">¶</a></h4>
<p>The PWM peripheral in dsPIC33EP parts splits the dead time in half, calculating edges for the low-side
and high-side outputs so that they are centered in time around the “ideal” switching instant
if there were no dead time. The widths of waveforms G, H, and L in <a class="reference internal" href="#fig-foc-pwmdeadtime"><span class="std std-numref">Figure 4.3</span></a> are the same,
but waveforms H and L are advanced in time by <span class="math notranslate nohighlight">\(\delta_1/2\)</span>.</p>
</section>
<section id="example-1">
<span id="foc-pwm-example-1"></span><h4><span class="section-number">4.4.4.2.2. </span>Example 1<a class="headerlink" href="#example-1" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>High-side transistor must be limited between <span class="math notranslate nohighlight">\(D_{HMIN}=1.2\%\)</span> duty cycle and <span class="math notranslate nohighlight">\(D_{HMAX} = 99\%\)</span> duty cycle</p></li>
<li><p>Low-side transistor must be limited between <span class="math notranslate nohighlight">\(D_{LMIN}=3.0\%\)</span> duty cycle and <span class="math notranslate nohighlight">\(D_{LMAX} = 99.5\%\)</span> duty cycle</p></li>
<li><p>Dead time of 2%</p></li>
</ul>
<p>This is a realistic case for a bootstrap gate drive, where <span class="math notranslate nohighlight">\(D_{LMIN}\)</span> is larger, to ensure adequate recharge time of the bootstrap capacitors.</p>
<p>We calculate</p>
<div class="math notranslate nohighlight" id="equation-components-foc-0">
<span class="eqno">(4.6)<a class="headerlink" href="#equation-components-foc-0" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
D_{BMIN} &amp;= \max(0.012, 1 - 0.995 - 0.04) = 0.012 \cr
D_{BMAX} &amp;= \min (1 - 0.03, 0.99 + 0.04) = 0.97
\end{aligned}\]</div>
<p>The waveform values produced by this are shown in <a class="reference internal" href="#table-foc-pwm-example1"><span class="std std-numref">Table 4.2</span></a>.</p>
<table class="docutils align-default" id="table-foc-pwm-example1">
<caption><span class="caption-number">Table 4.2 </span><span class="caption-text">Duty cycle ranges for Example 1</span><a class="headerlink" href="#table-foc-pwm-example1" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Waveform</p></th>
<th class="head"><p>Minimum duty cycle</p></th>
<th class="head"><p>Maximum duty cycle</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>G</p></td>
<td><p>0.032</p></td>
<td><p>0.95</p></td>
</tr>
<tr class="row-odd"><td><p>H</p></td>
<td><p>0.012</p></td>
<td><p>0.93</p></td>
</tr>
<tr class="row-even"><td><p>L</p></td>
<td><p>0.03</p></td>
<td><p>0.948</p></td>
</tr>
</tbody>
</table>
<p>Note that in this case, the limits are determined by the minimum duty cycles; the maximum duty cycles of the H and L waveforms are comfortably below their required maximum.</p>
</section>
<section id="example-2">
<h4><span class="section-number">4.4.4.2.3. </span>Example 2<a class="headerlink" href="#example-2" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>High-side transistor must be limited between <span class="math notranslate nohighlight">\(D_{HMIN} = 1.2\%\)</span> duty cycle and <span class="math notranslate nohighlight">\(D_{HMAX} = 90\%\)</span> duty cycle</p></li>
<li><p>Low-side transistor must be limited between <span class="math notranslate nohighlight">\(D_{LMIN} = 3.0\%\)</span> duty cycle and <span class="math notranslate nohighlight">\(D_{LMAX} = 80\%\)</span> duty cycle</p></li>
<li><p>Dead time of 2%</p></li>
</ul>
<p>We calculate</p>
<div class="math notranslate nohighlight" id="equation-components-foc-1">
<span class="eqno">(4.7)<a class="headerlink" href="#equation-components-foc-1" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
D_{BMIN} &amp;= \max(0.012, 1 - 0.8 - 0.04) = 0.16 \cr
D_{BMAX} &amp;= \min (1 - 0.03, 0.9 + 0.04) = 0.94
\end{aligned}\]</div>
<p>The waveform values produced by this are shown in shown in <a class="reference internal" href="#table-foc-pwm-example2"><span class="std std-numref">Table 4.3</span></a>.</p>
<table class="docutils align-default" id="table-foc-pwm-example2">
<caption><span class="caption-number">Table 4.3 </span><span class="caption-text">Duty cycle ranges for Example 2</span><a class="headerlink" href="#table-foc-pwm-example2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Waveform</p></th>
<th class="head"><p>Minimum duty cycle</p></th>
<th class="head"><p>Maximum duty cycle</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>G</p></td>
<td><p>0.18</p></td>
<td><p>0.92</p></td>
</tr>
<tr class="row-odd"><td><p>H</p></td>
<td><p>0.16</p></td>
<td><p>0.90</p></td>
</tr>
<tr class="row-even"><td><p>L</p></td>
<td><p>0.06</p></td>
<td><p>0.80</p></td>
</tr>
</tbody>
</table>
<p>In this case, the limits are determined by the maximum duty cycles; the minimum duty cycles of the H and L waveforms are comfortably above their required minimum.</p>
</section>
<section id="recommended-values-for-use-with-mb-and-mclv-2">
<h4><span class="section-number">4.4.4.2.4. </span>Recommended values for use with motorBench<sup>®</sup> Development Suite and MCLV-2<a class="headerlink" href="#recommended-values-for-use-with-mb-and-mclv-2" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>High-side transistor must be limited between <span class="math notranslate nohighlight">\(D_{HMIN} = 0.5\%\)</span> duty cycle and <span class="math notranslate nohighlight">\(D_{HMAX} = 99.5\%\)</span> duty cycle</p></li>
<li><p>Low-side transistor must be limited between <span class="math notranslate nohighlight">\(D_{LMIN} = 2.23\%\)</span> duty cycle and <span class="math notranslate nohighlight">\(D_{LMAX} = 99.5\%\)</span> duty cycle</p></li>
<li><p>Dead time of 4%</p></li>
</ul>
<p>We calculate</p>
<div class="math notranslate nohighlight" id="equation-components-foc-2">
<span class="eqno">(4.8)<a class="headerlink" href="#equation-components-foc-2" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
D_{BMIN} &amp;= \max(0.005, 1 - 0.995 - 0.08) = 0.005 \cr
D_{BMAX} &amp;= \min (1 - 0.0223, 0.995 + 0.04) = 0.9777
\end{aligned}\]</div>
<p>The waveform values produced by this are shown in <a class="reference internal" href="#table-foc-pwm-mclv2"><span class="std std-numref">Table 4.4</span></a>.</p>
<table class="docutils align-default" id="table-foc-pwm-mclv2">
<caption><span class="caption-number">Table 4.4 </span><span class="caption-text">Recommended duty cycle ranges for MCLV-2</span><a class="headerlink" href="#table-foc-pwm-mclv2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Waveform</p></th>
<th class="head"><p>Minimum duty cycle</p></th>
<th class="head"><p>Maximum duty cycle</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>G</p></td>
<td><p>0.045</p></td>
<td><p>0.9377</p></td>
</tr>
<tr class="row-odd"><td><p>H</p></td>
<td><p>0.005</p></td>
<td><p>0.8977</p></td>
</tr>
<tr class="row-even"><td><p>L</p></td>
<td><p>0.0223</p></td>
<td><p>0.915</p></td>
</tr>
</tbody>
</table>
<p>Note that in this case, the limits are determined by the minimum duty cycles; the maximum duty cycles of the H and L waveforms are comfortably below their required maximum.</p>
</section>
<section id="affected-source-code-files">
<h4><span class="section-number">4.4.4.2.5. </span>Affected source code files<a class="headerlink" href="#affected-source-code-files" title="Permalink to this heading">¶</a></h4>
<p>Since MCAF R3, the generated file parameters/hal_params.h contains <code class="docutils literal notranslate"><span class="pre">#define</span></code> symbols to determine minimum and maximum duty cycles.
There is also a comment that appears as follows:</p>
<div class="literal-block-wrapper docutils container" id="code-foc-1">
<div class="code-block-caption"><span class="caption-number">Listing 4.1 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">parameters/hal_params.h</span></code></span><a class="headerlink" href="#code-foc-1" title="Permalink to this code">¶</a></div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Minimum and maximum duty cycles,</span>
<span class="cm"> * from the perspective of the PWM duty cycle registers.</span>
<span class="cm"> *</span>
<span class="cm"> * The actual minimum and maximum duty cycles created by the PWM generators</span>
<span class="cm"> * will have dead time (=0.04) added and subtracted.</span>
<span class="cm"> *</span>
<span class="cm"> * NOTE: this assumes identical dead time,</span>
<span class="cm"> * and no significant difference in propagation delay between gate drive channels.</span>
<span class="cm"> *</span>
<span class="cm"> * Effective limits for duty cycle as seen on the PWM outputs:</span>
<span class="cm"> * Minimum duty cycle on PWMxH: 0.005</span>
<span class="cm"> * Minimum duty cycle on PWMxL: 0.0223</span>
<span class="cm"> * Maximum duty cycle on PWMxH: 0.8977</span>
<span class="cm"> * Maximum duty cycle on PWMxL: 0.915</span>
<span class="cm"> */</span>

<span class="cm">/* The minimum duty cycle of the half-bridge affects</span>
<span class="cm"> * the minimum duty cycle of upper transistors</span>
<span class="cm"> * and maximum duty cycle of lower transistors.</span>
<span class="cm"> */</span>
<span class="cm">/* Minimum duty cycle register value in counts */</span>
<span class="cp">#define HAL_PARAM_MIN_DUTY_COUNTS             157      </span><span class="c1">// Q0(157.00000)  =  +44.85714 m           =  +45.00000 m           - 0.3175%</span>
<span class="cm">/* Minimum duty cycle register value, as ratio */</span>
<span class="cp">#define HAL_PARAM_MIN_DUTY_Q15               1475      </span><span class="c1">// Q15(  0.04501) =  +45.01343 m           =  +45.00000 m           + 0.0298%</span>
<span class="cm">/* Maximum low-side duty cycle register value in counts */</span>
<span class="cp">#define HAL_PARAM_MAX_LOWER_DUTY_COUNTS       3342      </span><span class="c1">// Q0(3342.00000) = +954.85714 m           = +955.00000 m           - 0.0150%</span>


<span class="cm">/* The maximum duty cycle of the half-bridge affects</span>
<span class="cm"> * the maximum duty cycle of upper transistors</span>
<span class="cm"> * and minimum duty cycle of lower transistors.</span>
<span class="cm"> */</span>
<span class="cm">/* Maximum duty cycle register value in counts */</span>
<span class="cp">#define HAL_PARAM_MAX_DUTY_COUNTS            3282      </span><span class="c1">// Q0(3282.00000) = +937.71429 m           = +937.70000 m           + 0.0015%</span>
<span class="cm">/* Maximum duty cycle register value, as ratio */</span>
<span class="cp">#define HAL_PARAM_MAX_DUTY_Q15              30727      </span><span class="c1">// Q15(  0.93771) = +937.71362 m           = +937.70000 m           + 0.0015%</span>
<span class="cm">/* Minimum low-side duty cycle register value in counts */</span>
<span class="cp">#define HAL_PARAM_MIN_LOWER_DUTY_COUNTS        218      </span><span class="c1">// Q0(218.00000)  =  +62.28571 m           =  +62.30000 m           - 0.0229%</span>
</pre></div>
</div>
</div>
</section>
<section id="support-for-full-on-off-time-in-mcaf">
<h4><span class="section-number">4.4.4.2.6. </span>Support for full on/off time in MCAF<a class="headerlink" href="#support-for-full-on-off-time-in-mcaf" title="Permalink to this heading">¶</a></h4>
<p>MCAF does not support full on-time or off-time of either high-side or low-side transistor.
This is a tricky feature to implement, because it represents a small jump discontinuity of the intended duty cycle.</p>
</section>
</section>
<section id="modules">
<h3><span class="section-number">4.4.4.3. </span>Modules<a class="headerlink" href="#modules" title="Permalink to this heading">¶</a></h3>
<section id="core-foc">
<span id="index-6"></span><h4><span class="section-number">4.4.4.3.1. </span>Core FOC<a class="headerlink" href="#core-foc" title="Permalink to this heading">¶</a></h4>
<p></p>
<span id="index-3"></span><table class="components-table docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Module</p></th>
<th class="head"><p>Files</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">deadtimecomp</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">deadtimecomp.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">deadtimecomp.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">deadtimecomp_types.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/deadtimecomp_params.h</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="../algorithms/dead-time-comp.html#algorithm-deadtimecompensation"><span class="std std-ref">Dead-time compensation</span></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">dyn_current</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dyn_current.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">dyn_current.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">dyn_current_types.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/dyn_current_params.h</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="../algorithms/current-limit.html#algorithm-ilimit"><span class="std std-ref">Dynamic current limit</span></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">foc</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">foc.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">foc.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">foc_types.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/foc_params.h</span></code></div>
</div>
</td>
<td><p>Top-level FOC</p></td>
<td><p>These functions are called from the <a class="reference internal" href="statemach.html#component-statemachine"><span class="std std-ref">state machine</span></a> modules,
as described in the <a class="reference internal" href="statemach.html#component-statemachine-impl"><span class="std std-ref">implementation notes</span></a>.</p></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">sat_PI</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/sat_PI_params.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sat_PI.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sat_PI.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sat_PI_types.h</span></code></div>
</div>
</td>
<td><p>PI loop saturation management</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td class="longcolumn-3"><code class="docutils literal notranslate"><span class="pre">parameters/init_params</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/init_params.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/init_params.h</span></code></div>
</div>
</td>
<td><p>Initialization of FOC control parameters</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td class="longcolumn-3"><code class="docutils literal notranslate"><span class="pre">parameters/outerloop_params</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/outerloop_params.h</span></code></div>
</div>
</td>
<td><p>Parameters for specifying the outer loop type 
(velocity or <a class="reference internal" href="../algorithms/voltage-control.html#algorithm-voltagecontrol"><span class="std std-ref">voltage control</span></a>)</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
<section id="commutation">
<span id="index-7"></span><h4><span class="section-number">4.4.4.3.2. </span>Commutation<a class="headerlink" href="#commutation" title="Permalink to this heading">¶</a></h4>
<p></p>
<span id="index-4"></span><table class="components-table docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Module</p></th>
<th class="head"><p>Files</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">commutation</span></code></td>
<td class="longcolumn-2"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation_types.h</span></code></div>
</div>
</td>
<td><p>Top-level commutation / estimation</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td class="longcolumn-3"><code class="docutils literal notranslate"><span class="pre">commutation_excitation</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation_excitation.h</span></code></div>
</div>
</td>
<td><p>Handling of output excitation for
<a class="reference internal" href="../algorithms/estimator-interface.html#algorithm-estimator-terminology"><span class="std std-ref">intrusive estimators</span></a></p></td>
<td><p>Contains functions to compute required excitation voltage —
or zero, if only
<a class="reference internal" href="../algorithms/estimator-interface.html#algorithm-estimator-terminology"><span class="std std-ref">non-intrusive estimators</span></a>
are used.</p></td>
</tr>
<tr class="row-even"><td class="longcolumn-2"><code class="docutils literal notranslate"><span class="pre">commutation/atpll</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/atpll.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/atpll.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/atpll_params.h</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="../algorithms/atpll.html#algorithm-atpll"><span class="std std-ref">Angle-tracking Phase-locked Loop (ATPLL)</span></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td class="longcolumn-2"><code class="docutils literal notranslate"><span class="pre">commutation/common</span></code></td>
<td class="longcolumn-2"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/common.h</span></code></div>
</div>
</td>
<td><p>Common features used in all estimators</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td class="longcolumn-1"><code class="docutils literal notranslate"><span class="pre">commutation/pll</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/pll.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/pll.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/pll_params.h</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="../algorithms/pll.html#algorithm-pll"><span class="std std-ref">AN1292 Phase-locked Loop (PLL)</span></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td class="longcolumn-1"><code class="docutils literal notranslate"><span class="pre">commutation/qei</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/qei.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/qei.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/qei_types.h</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="../algorithms/qei.html#algorithm-qei"><span class="std std-ref">Quadrature encoder support</span></a></p></td>
<td><p>The quadrature encoder can be used as the primary estimator for commutation and velocity feedback, or to obtain a reference position and velocity for testing     estimator performance.</p></td>
</tr>
<tr class="row-even"><td class="longcolumn-2"><code class="docutils literal notranslate"><span class="pre">commutation/qei_sync</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/qei_sync.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/qei_sync.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/qei_sync_types.h</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="../algorithms/qei.html#qei-sync"><span class="std std-ref">Back-EMF synchronization</span></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td class="longcolumn-1"><code class="docutils literal notranslate"><span class="pre">commutation/zsmt</span></code></td>
<td class="longcolumn-3"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/zsmt.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/zsmt.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/zsmt_hybrid.c</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/zsmt_hybrid.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/zsmt_hybrid_interaction.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/zsmt_types.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">commutation/zsmtlib.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/zsmt_hybrid_params.h</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">parameters/zsmt_params.h</span></code></div>
</div>
</td>
<td><p><a class="reference internal" href="../algorithms/zsmt.html#algorithm-zsmt"><span class="std std-ref">Zero-Speed / Maximum Torque (ZS/MT)</span></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">4.4. Field-Oriented Control (FOC)</a><ul>
<li><a class="reference internal" href="#velocity-control">4.4.1. Velocity Control</a><ul>
<li><a class="reference internal" href="#voltage-control">4.4.1.1. Voltage Control</a></li>
</ul>
</li>
<li><a class="reference internal" href="#current-control">4.4.2. Current Control</a></li>
<li><a class="reference internal" href="#position-and-velocity-estimator">4.4.3. Position and Velocity Estimator</a></li>
<li><a class="reference internal" href="#implementation-notes">4.4.4. Implementation Notes</a><ul>
<li><a class="reference internal" href="#foc-feature-support">4.4.4.1. FOC feature support</a><ul>
<li><a class="reference internal" href="#flux-weakening">4.4.4.1.1. Flux weakening</a></li>
<li><a class="reference internal" href="#current-command-prefilter">4.4.4.1.2. Current command prefilter</a></li>
<li><a class="reference internal" href="#dc-link-voltage-compensation">4.4.4.1.3. DC link voltage compensation</a></li>
<li><a class="reference internal" href="#pwm-duty-cycle-realization">4.4.4.1.4. PWM duty cycle realization</a></li>
<li><a class="reference internal" href="#velocity-loop-current-limit">4.4.4.1.5. Velocity loop current limit</a></li>
<li><a class="reference internal" href="#saturation-and-anti-windup">4.4.4.1.6. Saturation and anti-windup</a></li>
<li><a class="reference internal" href="#flux-control">4.4.4.1.7. Flux control</a></li>
<li><a class="reference internal" href="#current-measurement-gain-and-offset-compensation">4.4.4.1.8. Current measurement / gain and offset compensation</a></li>
<li><a class="reference internal" href="#dead-time-compensation">4.4.4.1.9. Dead-time compensation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#numerical-values-for-pwm-duty-cycle-and-dead-time">4.4.4.2. Numerical values for PWM duty cycle and dead time</a><ul>
<li><a class="reference internal" href="#pwm-peripheral-in-dspic33-devices">4.4.4.2.1. PWM peripheral in dsPIC33 devices</a></li>
<li><a class="reference internal" href="#example-1">4.4.4.2.2. Example 1</a></li>
<li><a class="reference internal" href="#example-2">4.4.4.2.3. Example 2</a></li>
<li><a class="reference internal" href="#recommended-values-for-use-with-mb-and-mclv-2">4.4.4.2.4. Recommended values for use with motorBench<sup>®</sup> Development Suite and MCLV-2</a></li>
<li><a class="reference internal" href="#affected-source-code-files">4.4.4.2.5. Affected source code files</a></li>
<li><a class="reference internal" href="#support-for-full-on-off-time-in-mcaf">4.4.4.2.6. Support for full on/off time in MCAF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modules">4.4.4.3. Modules</a><ul>
<li><a class="reference internal" href="#core-foc">4.4.4.3.1. Core FOC</a></li>
<li><a class="reference internal" href="#commutation">4.4.4.3.2. Commutation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="statemach.html"
                          title="previous chapter"><span class="section-number">4.3. </span>State Machine</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="testharness.html"
                          title="next chapter"><span class="section-number">4.5. </span>Test Harness</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="testharness.html" title="4.5. Test Harness"
             >next</a> |</li>
        <li class="right" >
          <a href="statemach.html" title="4.3. State Machine"
             >previous</a> |</li>
    <li><img class="nav-logo"
             src="../_static/Microchip-Logo-Horizontal-White-Red-120x28.png" alt=""
        /></li>
    <li><a href=""></a> &#187;</li>
    <a href="../index.html">MCAF R7 RC37 (docver 7.0.2)</a> &#187;
    
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">4. </span>Components</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.4. </span>Field-Oriented Control (FOC)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017-2023, Microchip Technology, Inc..
    </div>
  </body>
</html>