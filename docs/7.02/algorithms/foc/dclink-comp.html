<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>5.1.5. DC link compensation &#8212; MCAF R7 RC37 documentation (docver 7.0.2)</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/microchip.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mcaf_doc.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/contrib/auto-render.min.js"></script>
    <script src="../../_static/rendermath.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js"></script>
    <script src="../../_static/svgcrop.js"></script>
    <script src="../../_static/mcaf-styling.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.1.6. Current loop tuning" href="tuning.html" />
    <link rel="prev" title="5.1.4. Overmodulation" href="overmodulation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tuning.html" title="5.1.6. Current loop tuning"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overmodulation.html" title="5.1.4. Overmodulation"
             accesskey="P">previous</a> |</li>
    <li><img class="nav-logo"
             src="../../_static/Microchip-Logo-Horizontal-White-Red-120x28.png" alt=""
        /></li>
    <li><a href=""></a> &#187;</li>
    <a href="../../index.html">MCAF R7 RC37 (docver 7.0.2)</a> &#187;
    
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">5. </span>Detailed Algorithm Notes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">5.1. </span>Field-oriented Current Control</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.1.5. </span>DC link compensation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="dc-link-compensation">
<span id="algorithm-dclinkcompensation"></span><span id="index-0"></span><h1><span class="section-number">5.1.5. </span>DC link compensation<a class="headerlink" href="#dc-link-compensation" title="Permalink to this heading">¶</a></h1>
<p>Variability in the DC link voltage manifests itself as a time-varying
gain of the power electronics block; if the DC link voltage increases
by 10%, then for the same duty cycles applied to a three-phase bridge,
the voltage output will also be increased by 10%.</p>
<p>This affects the behavior of a FOC motor controller in a few significant ways:</p>
<ul class="simple">
<li><p>Current controller loop gain changes proportionally to DC link voltage.
This variation can degrade the stability of the current controller.</p></li>
<li><p>Voltage transients in the DC link cause a disturbance to the current loop.</p></li>
<li><p>Sensorless estimators that rely only on duty cycle signals will
also see a gain shift proportional to DC link voltage.</p></li>
</ul>
<p>We can compensate for DC link voltage by converting from voltage to duty cycle
in the forward path, as shown in <a class="reference internal" href="#fig-dclink-fwdpath"><span class="std std-numref">Figure 5.16</span></a>.</p>
<figure class="align-center" id="id1">
<span id="fig-dclink-fwdpath"></span><a class="reference internal image-reference" href="../../_images/accret-bdiag-fwdpath.png"><img alt="../../_images/accret-bdiag-fwdpath.png" src="../../_images/accret-bdiag-fwdpath.png" style="width: 900px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 5.16 </span><span class="caption-text">Block diagram of MCAF Field Oriented Control, forward path</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Essentially the <span class="math notranslate nohighlight">\(abc\)</span> voltages coming out of the Inverse Clarke
blocks are multiplied by the reciprocal of the DC link voltage
and then used as the input of the zero sequence modulation (ZSM) block:</p>
<div class="math notranslate nohighlight" id="equation-algorithms-foc-dclink-comp-0">
<span class="eqno">(5.20)<a class="headerlink" href="#equation-algorithms-foc-dclink-comp-0" title="Permalink to this equation">¶</a></span>\[D_{abc0} = R_V V_{abc0} = \frac{1}{V_{dc}}V_{abc0}\]</div>
<p>where the subscript <span class="math notranslate nohighlight">\(abc0\)</span> represents the unmodified three-phase
output of the Inverse Clarke transform, prior to shifting and clipping
by the ZSM block.</p>
<p>In addition, we need to make the output limits of the current
controller scale proportionally to <span class="math notranslate nohighlight">\(V_{dc}\)</span>,
in order to reflect the physical limits of the three-phase bridge.</p>
<section id="transients">
<h2><span class="section-number">5.1.5.1. </span>Transients<a class="headerlink" href="#transients" title="Permalink to this heading">¶</a></h2>
<p>DC link compensation will work correctly in the
presence of transients if the dynamics of sensing <span class="math notranslate nohighlight">\(V_{dc}\)</span>
are much faster than the dynamics of the voltage transient itself.</p>
<p>On the <a class="reference external" href="https://www.microchip.com/DevelopmentTools/ProductDetails/dm330021-2">dsPICDEM<sup>®</sup> MCLV‑2 Development Board</a>,
for example, there is a 188 μs RC filter (see <a class="reference internal" href="#fig-dclink-rc"><span class="std std-numref">Figure 5.17</span></a>)
that dominates
the dynamic behavior of sensing. This has a 3 dB bandwidth
of about 847 Hz, so DC link compensation should be able to
reject transients with frequency content significantly lower
than this, and cannot reject transient content around or above
this frequency. In general, motor drive designs should use
RC filters with shorter time constants, typically on the order
of 1 – 10 μs; antialiasing concerns are usually less
important than avoiding excessive phase lag, because the DC link
capacitors already limit high frequency content.</p>
<figure class="align-center" id="id2">
<span id="fig-dclink-rc"></span><img alt="../../_images/mclv2-rcfilt.png" src="../../_images/mclv2-rcfilt.png" />
<figcaption>
<p><span class="caption-number">Figure 5.17 </span><span class="caption-text">RC filter in MCLV-2</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="implementation-notes">
<h2><span class="section-number">5.1.5.2. </span>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permalink to this heading">¶</a></h2>
<p>The reciprocal step of computing <span class="math notranslate nohighlight">\(R_V = 1/V_{dc}\)</span> in fixed-point
relies on choosing a reasonable scaling factor. In the MCAF, we
use Q12 representation with a scaling factor of <span class="math notranslate nohighlight">\(1/V_{dcmax}\)</span>,
which allows accurate computation of <span class="math notranslate nohighlight">\(R_V\)</span>
over the voltage range <span class="math notranslate nohighlight">\(\frac{V_{dc}}{V_{dcmax}} \in [1/8, 1]\)</span>.
For the MCLV-2 board’s maximum input voltage range of 52.8 V, this
allows accurate reciprocal calculations between 6.6 V and 52.8 V.
For the MCHV-2 and MCHV-3 boards’ maximum input voltage range of 453.3 V,
this allows accurate reciprocal calculations between 56.7 V and 453.3 V.</p>
<p>If <span class="math notranslate nohighlight">\(V_{dc} &lt; V_{dcmax}/8\)</span> the reciprocal is clamped at its maximum
value (32767 counts = <span class="math notranslate nohighlight">\(7.99976/V_{dcmax}\)</span>) and the DC link
compensation will not be perfect; in this case the overall
open-loop gain (including the gain of the three-phase bridge in hardware,
and DC link compensation in software) will be less than one.</p>
<section id="feature-support">
<h3><span class="section-number">5.1.5.2.1. </span>Feature support<a class="headerlink" href="#feature-support" title="Permalink to this heading">¶</a></h3>
<p>DC link compensation was not present in MCAF R1 but has been added in MCAF R2.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">5.1.5. DC link compensation</a><ul>
<li><a class="reference internal" href="#transients">5.1.5.1. Transients</a></li>
<li><a class="reference internal" href="#implementation-notes">5.1.5.2. Implementation Notes</a><ul>
<li><a class="reference internal" href="#feature-support">5.1.5.2.1. Feature support</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="overmodulation.html"
                          title="previous chapter"><span class="section-number">5.1.4. </span>Overmodulation</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="tuning.html"
                          title="next chapter"><span class="section-number">5.1.6. </span>Current loop tuning</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tuning.html" title="5.1.6. Current loop tuning"
             >next</a> |</li>
        <li class="right" >
          <a href="overmodulation.html" title="5.1.4. Overmodulation"
             >previous</a> |</li>
    <li><img class="nav-logo"
             src="../../_static/Microchip-Logo-Horizontal-White-Red-120x28.png" alt=""
        /></li>
    <li><a href=""></a> &#187;</li>
    <a href="../../index.html">MCAF R7 RC37 (docver 7.0.2)</a> &#187;
    
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">5. </span>Detailed Algorithm Notes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">5.1. </span>Field-oriented Current Control</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.1.5. </span>DC link compensation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017-2023, Microchip Technology, Inc..
    </div>
  </body>
</html>