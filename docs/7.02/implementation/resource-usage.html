<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6.6. Resource Usage &#8212; MCAF R7 RC37 documentation (docver 7.0.2)</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/microchip.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mcaf_doc.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/contrib/auto-render.min.js"></script>
    <script src="../_static/rendermath.js"></script>
    <script src="../_static/svgcrop.js"></script>
    <script src="../_static/mcaf-styling.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Appendix" href="../appendix/index.html" />
    <link rel="prev" title="6.5. Integration with Custom Code" href="integration.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../appendix/index.html" title="7. Appendix"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="integration.html" title="6.5. Integration with Custom Code"
             accesskey="P">previous</a> |</li>
    <li><img class="nav-logo"
             src="../_static/Microchip-Logo-Horizontal-White-Red-120x28.png" alt=""
        /></li>
    <li><a href=""></a> &#187;</li>
    <a href="../index.html">MCAF R7 RC37 (docver 7.0.2)</a> &#187;
    
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U"><span class="section-number">6. </span>General Implementation Issues</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.6. </span>Resource Usage</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="resource-usage">
<span id="id1"></span><h1><span class="section-number">6.6. </span>Resource Usage<a class="headerlink" href="#resource-usage" title="Permalink to this heading">¶</a></h1>
<p>This section provides reference data for resource usage, covering program and data memory and CPU usage.</p>
<p><strong>Please note</strong>: Resource usage is dependent on a number of factors, and may be different than the
data shown below. These factors include:</p>
<ul class="simple">
<li><p>Compiler version</p></li>
<li><p>Compiler optimization levels</p></li>
<li><p>Compiler flags</p></li>
<li><p>Settings in motorBench<sup>®</sup> Development Suite</p></li>
<li><p>Settings in MCC</p></li>
<li><p>MCAF parameter values</p></li>
</ul>
<section id="test-case">
<h2><span class="section-number">6.6.1. </span>Test case<a class="headerlink" href="#test-case" title="Permalink to this heading">¶</a></h2>
<p>In each case described below, MCAF firmware packages were used
with their default settings and the AN1292 PLL estimator selected, for the <a class="reference external" href="https://www.microchip.com/DevelopmentTools/ProductDetails/AC300022">Nidec Hurst DMA0204024B101</a> motor used with the <a class="reference external" href="https://www.microchip.com/DevelopmentTools/ProductDetails/dm330021-2">dsPICDEM<sup>®</sup> MCLV‑2 Development Board</a>.
The source code was built using XC16 with <code class="docutils literal notranslate"><span class="pre">-O1</span></code> and <code class="docutils literal notranslate"><span class="pre">-O2</span></code>
compilation levels for the dsPIC33EP256MC506, and with <code class="docutils literal notranslate"><span class="pre">MCAF_TEST_PROFILING</span></code> and <code class="docutils literal notranslate"><span class="pre">MCAF_TEST_HARNESS</span></code> enabled.</p>
<section id="program-and-data-memory">
<h3><span class="section-number">6.6.1.1. </span>Program and data memory<a class="headerlink" href="#program-and-data-memory" title="Permalink to this heading">¶</a></h3>
<p>Resource usage statistics for program and data memory were derived from the map file.</p>
</section>
<section id="cpu-usage">
<h3><span class="section-number">6.6.1.2. </span>CPU usage<a class="headerlink" href="#cpu-usage" title="Permalink to this heading">¶</a></h3>
<p>CPU usage was determined with variants of MCAF modified to transmit CPU cycle count data via the UART, at various points in the motor control ISR, for a 20 kHz PWM ISR,
using the dsPIC33EP256MC506 running at 70 MIPS, and dsPIC33CK256MP508 running at 100 MIPS.</p>
<p>CPU cycle count was measured over approximately 4 seconds, with the motor starting up, running, and slowing to a stop. The resulting time inside the motor control ISR was sorted from
low to high, with the worst-case and 99.9% percentile computed. For example, 4 seconds of data at 20 kHz represents 80,000 data points, so the 99.9% percentile represents
the 80th-highest sample of CPU usage. This represents conservative estimates of CPU usage for estimating remaining CPU capacity in aggregate over time, and exclude timing spikes
which may occur when long execution paths coincide in the same ISR cycle. The worst-case CPU usage
should be used to determine that the ISR does not overrun available time limits. Variation in CPU time is due to a number of factors, including:</p>
<ul class="simple">
<li><p>Branches (<code class="docutils literal notranslate"><span class="pre">if</span></code> statements) may take alternate and unequal execution paths</p></li>
<li><p>Some algorithms run at submultiples of the ISR, so for example the PLL position estimator has a portion of code that runs once every 8 ISR cycles</p></li>
<li><p>During different states of the <a class="reference internal" href="../components/statemach.html#component-statemachine"><span class="std std-ref">state machine</span></a>, different parts of the code are enabled or disabled</p></li>
</ul>
<p>Main loop CPU usage was not profiled but is minimal (estimated at &lt; 0.1 MIPS); not much code runs in the main loop.</p>
</section>
</section>
<section id="usage-statistics-for-mcaf-r3">
<h2><span class="section-number">6.6.2. </span>Usage statistics for MCAF R3<a class="headerlink" href="#usage-statistics-for-mcaf-r3" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Statistic</p></th>
<th class="head"><p>MCAF R3, XC16 1.35 <code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p>MCAF R3, XC16 1.35 <code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>Program memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>20367</p></td>
<td><p>21744</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>12831</p></td>
<td><p>12831</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>33198</p></td>
<td><p>34575</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Data memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>1342</p></td>
<td><p>1340</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>5466</p></td>
<td><p>5466</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>6808</p></td>
<td><p>6806</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CPU ISR usage</strong> (% at 70 MIPS, 20 kHz ISR)</p></td>
</tr>
<tr class="row-odd"><td><p>Worst-case</p></td>
<td><p>64.1%</p></td>
<td><p>62.9%</p></td>
</tr>
<tr class="row-even"><td><p>99.9% percentile</p></td>
<td><p>63.8%</p></td>
<td><p>62.6%</p></td>
</tr>
</tbody>
</table>
</section>
<section id="usage-statistics-for-mcaf-r4">
<h2><span class="section-number">6.6.3. </span>Usage statistics for MCAF R4<a class="headerlink" href="#usage-statistics-for-mcaf-r4" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Statistic</p></th>
<th class="head"><p>MCAF R4, XC16 1.36b <code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p>MCAF R4, XC16 1.36b <code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>Program memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>17556</p></td>
<td><p>18150</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>12831</p></td>
<td><p>12753</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>30309</p></td>
<td><p>30903</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Data memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>1402</p></td>
<td><p>1402</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>5448</p></td>
<td><p>5448</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>6850</p></td>
<td><p>6850</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CPU ISR usage</strong> (% at 70 MIPS, 20 kHz ISR)</p></td>
</tr>
<tr class="row-odd"><td><p>Worst-case</p></td>
<td><p>58.9%</p></td>
<td><p>58.1%</p></td>
</tr>
<tr class="row-even"><td><p>99.9% percentile</p></td>
<td><p>58.9%</p></td>
<td><p>58.1%</p></td>
</tr>
</tbody>
</table>
</section>
<section id="usage-statistics-for-mcaf-r5">
<h2><span class="section-number">6.6.4. </span>Usage statistics for MCAF R5<a class="headerlink" href="#usage-statistics-for-mcaf-r5" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Statistic</p></th>
<th class="head"><p>MCAF R5, XC16 1.41 <code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p>MCAF R5, XC16 1.41 <code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>Program memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>17334</p></td>
<td><p>18783</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>11709</p></td>
<td><p>11709</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>29043</p></td>
<td><p>30492</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Data memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>1528</p></td>
<td><p>1580</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>5186</p></td>
<td><p>5186</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>6714</p></td>
<td><p>6766</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CPU ISR usage</strong> (% at 70 MIPS, 20 kHz ISR)</p></td>
</tr>
<tr class="row-odd"><td><p>Worst-case</p></td>
<td><p>58.3%</p></td>
<td><p>57.6%</p></td>
</tr>
<tr class="row-even"><td><p>99.9% percentile</p></td>
<td><p>57.8%</p></td>
<td><p>57.0%</p></td>
</tr>
</tbody>
</table>
</section>
<section id="usage-statistics-for-mcaf-r6">
<span id="resource-usage-r6"></span><h2><span class="section-number">6.6.5. </span>Usage statistics for MCAF R6<a class="headerlink" href="#usage-statistics-for-mcaf-r6" title="Permalink to this heading">¶</a></h2>
<p><strong>dsPIC33EP256MC506</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Statistic</p></th>
<th class="head"><p>MCAF R6, XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p>MCAF R6, XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>Program memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>17376</p></td>
<td><p>18219</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>11709</p></td>
<td><p>11709</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>29916</p></td>
<td><p>30885</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Data memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>1672</p></td>
<td><p>1672</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>5186</p></td>
<td><p>5186</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>6858</p></td>
<td><p>6858</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CPU ISR usage</strong> (approximate number of cycles,
and percentage at 70 MIPS, 20 kHz ISR)</p></td>
</tr>
<tr class="row-odd"><td><p>Worst-case</p></td>
<td><p>2330 (66.5%)</p></td>
<td><p>2280 (65.2%)</p></td>
</tr>
<tr class="row-even"><td><p>99.9% percentile</p></td>
<td><p>2300 (65.8%)</p></td>
<td><p>2260 (64.6%)</p></td>
</tr>
</tbody>
</table>
<p><strong>dsPIC33CK256MP508</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Statistic</p></th>
<th class="head"><p>MCAF R6, XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p>MCAF R6, XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>Program memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>17442</p></td>
<td><p>18210</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>11625</p></td>
<td><p>11625</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>29067</p></td>
<td><p>29835</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Data memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>1672</p></td>
<td><p>1672</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>5186</p></td>
<td><p>5186</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>6858</p></td>
<td><p>6858</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CPU ISR usage</strong> (approximate number of cycles,
and percentage at 100 MIPS, 20 kHz ISR)</p></td>
</tr>
<tr class="row-odd"><td><p>Worst-case</p></td>
<td><p>2286 (45.7%)</p></td>
<td><p>2247 (44.9%)</p></td>
</tr>
<tr class="row-even"><td><p>99.9% percentile</p></td>
<td><p>2272 (45.4%)</p></td>
<td><p>2226 (44.5%)</p></td>
</tr>
</tbody>
</table>
<p><strong>Algorithm options and variants</strong> — these represent additional usage costs in
CPU usage, program (code) memory size, and data memory size, above
the base case shown above. CPU measurements are approximate, based on capturing elapsed
timer measurements from the test harness. All measurements are made from independent
test cases enabling one module or option at a time, which may not take into account
interaction between modules; for example,
the compiler may be able to identify additional optimization opportunities
if more than one of the cases below are enabled simultaneously, or the additional
computations may cause additional CPU cycles for register moves
that are not required when the same modules are enabled separately.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Module</p></th>
<th class="head" rowspan="2"><p>Option</p></th>
<th class="head" rowspan="2"><p>CPU usage
<br />
(cycles)</p></th>
<th class="head" colspan="2"><p>Size   (bytes)</p></th>
<th class="head" rowspan="2"><p>Conditions</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Code</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../algorithms/dead-time-comp.html#algorithm-deadtimecompensation"><span class="std std-ref">Dead-time compensation</span></a></p></td>
<td><p>Per-phase</p></td>
<td><p>+66</p></td>
<td><p>+309</p></td>
<td><p>+28</p></td>
<td><p>XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../algorithms/flux_control/index.html#algorithm-flux-control"><span class="std std-ref">Flux control</span></a></p></td>
<td><p>Equation-based,
FW+MTPA disabled</p></td>
<td><p>+115</p></td>
<td><p>+816</p></td>
<td><p>+60</p></td>
<td><p>XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508),
full-saliency forced on</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../algorithms/flux_control/index.html#algorithm-flux-control"><span class="std std-ref">Flux control</span></a></p></td>
<td><p>Equation-based,
FW enabled</p></td>
<td><p>+407</p></td>
<td><p>+1191</p></td>
<td><p>+60</p></td>
<td><p>XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508),
full-saliency forced on</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../algorithms/flux_control/index.html#algorithm-flux-control"><span class="std std-ref">Flux control</span></a></p></td>
<td><p>Equation-based,
MTPA enabled</p></td>
<td><p>+256</p></td>
<td><p>+954</p></td>
<td><p>+60</p></td>
<td><p>XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508),
full-saliency forced on</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../algorithms/flux_control/index.html#algorithm-flux-control"><span class="std std-ref">Flux control</span></a></p></td>
<td><p>Equation-based,
FW+MTPA enabled</p></td>
<td><p>+531</p></td>
<td><p>+1293</p></td>
<td><p>+60</p></td>
<td><p>XC16 1.60 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508),
full-saliency forced on</p></td>
</tr>
</tbody>
</table>
</section>
<section id="usage-statistics-for-mcaf-r7">
<span id="resource-usage-r7"></span><h2><span class="section-number">6.6.6. </span>Usage statistics for MCAF R7<a class="headerlink" href="#usage-statistics-for-mcaf-r7" title="Permalink to this heading">¶</a></h2>
<p><strong>dsPIC33EP256MC506</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Statistic</p></th>
<th class="head"><p>MCAF R7, XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p>MCAF R7, XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>Program memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>19569</p></td>
<td><p>21063</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>11787</p></td>
<td><p>11787</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>31356</p></td>
<td><p>32850</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Data memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>1534</p></td>
<td><p>1534</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>5376</p></td>
<td><p>5376</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>6910</p></td>
<td><p>6910</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CPU ISR usage</strong> (approximate number of cycles,
and percentage at 70 MIPS, 20 kHz ISR)</p></td>
</tr>
<tr class="row-odd"><td><p>Worst-case</p></td>
<td><p>2574 (73.5%)</p></td>
<td><p>2546 (72.7%)</p></td>
</tr>
<tr class="row-even"><td><p>99.9% percentile</p></td>
<td><p>2552 (72.9%)</p></td>
<td><p>2523 (72.1%)</p></td>
</tr>
</tbody>
</table>
<p><strong>dsPIC33CK256MP508</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Statistic</p></th>
<th class="head" colspan="2"><p>MCAF R7, XC16 2.00</p></th>
<th class="head" colspan="2"><p>MCAF R7, XC16 1.70</p></th>
<th class="head" colspan="2"><p>MCAF R7, XC16 1.60</p></th>
</tr>
<tr class="row-even"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td colspan="7"><p><strong>Program memory</strong> (bytes)</p></td>
</tr>
<tr class="row-even"><td><p>Excluding X2Cscope</p></td>
<td><p>18630</p></td>
<td><p>20055</p></td>
<td><p>18636</p></td>
<td><p>19374</p></td>
<td><p>18621</p></td>
<td><p>19353</p></td>
</tr>
<tr class="row-odd"><td><p>X2Cscope module</p></td>
<td><p>11703</p></td>
<td><p>11703</p></td>
<td><p>11703</p></td>
<td><p>11703</p></td>
<td><p>11703</p></td>
<td><p>11703</p></td>
</tr>
<tr class="row-even"><td><p>Total</p></td>
<td><p>30333</p></td>
<td><p>31758</p></td>
<td><p>30339</p></td>
<td><p>31077</p></td>
<td><p>30324</p></td>
<td><p>31056</p></td>
</tr>
<tr class="row-odd"><td colspan="7"><p><strong>Data memory</strong> (bytes)</p></td>
</tr>
<tr class="row-even"><td><p>Excluding X2Cscope</p></td>
<td><p>1534</p></td>
<td><p>1534</p></td>
<td><p>1588</p></td>
<td><p>1588</p></td>
<td><p>1588</p></td>
<td><p>1588</p></td>
</tr>
<tr class="row-odd"><td><p>X2Cscope module</p></td>
<td><p>5378</p></td>
<td><p>5378</p></td>
<td><p>5378</p></td>
<td><p>5378</p></td>
<td><p>5378</p></td>
<td><p>5378</p></td>
</tr>
<tr class="row-even"><td><p>Total</p></td>
<td><p>6912</p></td>
<td><p>6912</p></td>
<td><p>6966</p></td>
<td><p>6966</p></td>
<td><p>6966</p></td>
<td><p>6966</p></td>
</tr>
<tr class="row-odd"><td colspan="7"><p><strong>CPU ISR usage</strong> (approximate number of cycles,
and percentage at 100 MIPS, 20 kHz ISR)</p></td>
</tr>
<tr class="row-even"><td><p>Worst-case</p></td>
<td><p>2470 (49.4%)</p></td>
<td><p>2504 (50.1%)</p></td>
<td><p>2332 (46.6%)</p></td>
<td><p>2273 (45.5%)</p></td>
<td><p>2322 (46.4%)</p></td>
<td><p>2276 (45.5%)</p></td>
</tr>
<tr class="row-odd"><td><p>99.9% percentile</p></td>
<td><p>2457 (49.1%)</p></td>
<td><p>2481 (49.6%)</p></td>
<td><p>2314 (46.3%)</p></td>
<td><p>2252 (45.0%)</p></td>
<td><p>2307 (46.1%)</p></td>
<td><p>2255 (45.1%)</p></td>
</tr>
</tbody>
</table>
<p><strong>dsPIC33CK64MC105</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Statistic</p></th>
<th class="head"><p>MCAF R7, XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O1</span></code></p></th>
<th class="head"><p>MCAF R7, XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O2</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>Program memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>24513</p></td>
<td><p>26049</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>11703</p></td>
<td><p>11703</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>36216</p></td>
<td><p>37752</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Data memory</strong> (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>Excluding X2Cscope</p></td>
<td><p>1536</p></td>
<td><p>1536</p></td>
</tr>
<tr class="row-even"><td><p>X2Cscope module</p></td>
<td><p>5378</p></td>
<td><p>5378</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>6914</p></td>
<td><p>6914</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>CPU ISR usage</strong> (approximate number of cycles,
and percentage at 100 MIPS, 20 kHz ISR)</p></td>
</tr>
<tr class="row-odd"><td><p>Worst-case</p></td>
<td><p>2405 (48.1%)</p></td>
<td><p>2503 (50.1%)</p></td>
</tr>
<tr class="row-even"><td><p>99.9% percentile</p></td>
<td><p>2391 (47.8%)</p></td>
<td><p>2470 (49.4%)</p></td>
</tr>
</tbody>
</table>
<p><strong>Algorithm options and variants</strong> — these represent additional usage costs in
CPU usage, program (code) memory size, and data memory size, above
the base case shown above. CPU measurements are approximate, based on capturing elapsed
timer measurements from the test harness. All measurements are made from independent
test cases enabling one module or option at a time, which may not take into account
interaction between modules; for example,
the compiler may be able to identify additional optimization opportunities
if more than one of the cases below are enabled simultaneously, or the additional
computations may cause additional CPU cycles for register moves
that are not required when the same modules are enabled separately.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Module</p></th>
<th class="head" rowspan="2"><p>Option</p></th>
<th class="head" rowspan="2"><p>CPU usage
<br />
(cycles)</p></th>
<th class="head" colspan="2"><p>Size   (bytes)</p></th>
<th class="head" rowspan="2"><p>Conditions</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Code</p></th>
<th class="head"><p>Data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../algorithms/foc/current_measure.html#algorithm-current-measure"><span class="std std-ref">Current measurement</span></a></p></td>
<td><p>Single-channel</p></td>
<td><p>+200</p></td>
<td><p>+2136</p></td>
<td><p>+56</p></td>
<td><p>XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../algorithms/foc/current_measure.html#algorithm-current-measure"><span class="std std-ref">Current measurement</span></a></p></td>
<td><p>Triple-channel</p></td>
<td><p>+54</p></td>
<td><p>+357</p></td>
<td><p>+10</p></td>
<td><p>XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../algorithms/current-limit.html#algorithm-ilimit-dynamic"><span class="std std-ref">Dynamic current limit</span></a></p></td>
<td><p>Simple</p></td>
<td><p>+74</p></td>
<td><p>+501</p></td>
<td><p>+30</p></td>
<td><p>XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../algorithms/zsmt.html#algorithm-zsmt"><span class="std std-ref">Zero-Speed / Maximum Torque (ZS/MT)</span></a></p></td>
<td><p>ZS/MT standalone
estimator</p></td>
<td><p>-342</p></td>
<td><p>-516</p></td>
<td><p>+10</p></td>
<td><p>XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../algorithms/zsmt.html#algorithm-zsmt"><span class="std std-ref">Zero-Speed / Maximum Torque (ZS/MT)</span></a></p></td>
<td><p>Binary hard-switch
hybrid estimator</p></td>
<td><p>+340</p></td>
<td><p>+2727</p></td>
<td><p>+128</p></td>
<td><p>XC16 2.00 <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, 33C
(dsPIC33CK256MP508)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="changes-between-mcaf-revisions">
<h2><span class="section-number">6.6.7. </span>Changes between MCAF revisions<a class="headerlink" href="#changes-between-mcaf-revisions" title="Permalink to this heading">¶</a></h2>
<p>The apparent decrease in ISR usage between MCAF R3 and R4 should not be
taken as conclusive. Microchip staff have performed similar tests where the CPU usage time
has increased slightly from MCAF R3 to MCAF R4; we are aware of the issue and
are investigating more reliable methods to compare CPU usage between MCAF revisions
under controlled conditions.</p>
<p>MCAF R6 and R7 have each increased CPU usage slightly, compared to MCAF R5.
Microchip staff is investigating causes and potential ways to reduce CPU usage
in future MCAF revisions.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">6.6. Resource Usage</a><ul>
<li><a class="reference internal" href="#test-case">6.6.1. Test case</a><ul>
<li><a class="reference internal" href="#program-and-data-memory">6.6.1.1. Program and data memory</a></li>
<li><a class="reference internal" href="#cpu-usage">6.6.1.2. CPU usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage-statistics-for-mcaf-r3">6.6.2. Usage statistics for MCAF R3</a></li>
<li><a class="reference internal" href="#usage-statistics-for-mcaf-r4">6.6.3. Usage statistics for MCAF R4</a></li>
<li><a class="reference internal" href="#usage-statistics-for-mcaf-r5">6.6.4. Usage statistics for MCAF R5</a></li>
<li><a class="reference internal" href="#usage-statistics-for-mcaf-r6">6.6.5. Usage statistics for MCAF R6</a></li>
<li><a class="reference internal" href="#usage-statistics-for-mcaf-r7">6.6.6. Usage statistics for MCAF R7</a></li>
<li><a class="reference internal" href="#changes-between-mcaf-revisions">6.6.7. Changes between MCAF revisions</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="integration.html"
                          title="previous chapter"><span class="section-number">6.5. </span>Integration with Custom Code</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../appendix/index.html"
                          title="next chapter"><span class="section-number">7. </span>Appendix</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../appendix/index.html" title="7. Appendix"
             >next</a> |</li>
        <li class="right" >
          <a href="integration.html" title="6.5. Integration with Custom Code"
             >previous</a> |</li>
    <li><img class="nav-logo"
             src="../_static/Microchip-Logo-Horizontal-White-Red-120x28.png" alt=""
        /></li>
    <li><a href=""></a> &#187;</li>
    <a href="../index.html">MCAF R7 RC37 (docver 7.0.2)</a> &#187;
    
          <li class="nav-item nav-item-1"><a href="index.html" ><span class="section-number">6. </span>General Implementation Issues</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.6. </span>Resource Usage</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017-2023, Microchip Technology, Inc..
    </div>
  </body>
</html>